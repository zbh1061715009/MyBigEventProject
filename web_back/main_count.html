<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <title>图表统计</title>
        <link rel="stylesheet" href="js/bootstrap/css/bootstrap.min.css">
        <link rel="stylesheet" href="css/reset.css">
        <link rel="stylesheet" href="css/iconfont.css">
        <link rel="stylesheet" href="css/main.css">
        <script src="js/jquery-1.12.4.min.js"></script>
        <script type="text/javascript" src="js/echarts.min.js"></script>
        <script>
            $(function () {
                // 获取文章列表元素
                var spannel_list = $(".spannel_list");

                // 初始化文章数量
                $.get({
                    url: "http://localhost:8000/admin/article_count",
                    success: function (backData) {
                        if (backData.code == 200) {
                            spannel_list.children("div").eq(0).find("em").text(backData.data.all_count);
                            spannel_list.children("div").eq(1).find("em").text(backData.data.day_count);
                        }
                    }

                });

                // 初始化文章评论数量
                $.get({
                    url: "http://localhost:8000/admin/comment_count",
                    success: function (backData) {
                        if (backData.code == 200) {
                            spannel_list.children("div").eq(2).find("em").text(backData.data.all_count);
                            spannel_list.children("div").eq(3).find("em").text(backData.data.day_count);
                        }
                    }

                });
            });
        </script>
    </head>

    <body>
        <div class="container-fluid">
            <div class="row spannel_list">
                <div class="col-sm-3 col-xs-6">
                    <div class="spannel">
                        <em>10015</em><span>篇</span>
                        <b>总文章数</b>
                    </div>
                </div>
                <div class="col-sm-3 col-xs-6">
                    <div class="spannel scolor01">
                        <em>123</em><span>篇</span>
                        <b>日新增文章数</b>
                    </div>
                </div>
                <div class="col-sm-3 col-xs-6">
                    <div class="spannel scolor02">
                        <em>35</em><span>条</span>
                        <b>评论总数</b>
                    </div>
                </div>
                <div class="col-sm-3 col-xs-6">
                    <div class="spannel scolor03">
                        <em>123</em><span>条</span>
                        <b>日新增评论数</b>
                    </div>
                </div>
            </div>
        </div>

        <div class="container-fluid">
            <div class="row curve-pie">
                <div class="col-lg-8 col-md-8">
                    <div class="gragh_pannel" id="curve_show"></div>
                </div>
                <div class="col-lg-4 col-md-4">
                    <div class="gragh_pannel" id="pie_show"></div>
                </div>
            </div>
        </div>

        <div class="container-fluid">
            <div class="column_pannel" id="column_show"></div>
        </div>

        <script>

            total();

            // 初始化月新增文章数
            $.get({
                url: "http://localhost:8000/admin/month_article_count",
                success: function (backData) {
                    var aList_all;
                    if (backData.code == 200) {
                        // 清空折线数组aList_all
                        aList_all = [];
                        // 遍历返回数据,且将返回的折线对照数据逐一加载到数组aList_all中
                        var arr = backData.data;
                        // console.log(arr);
                        for (var i = 0; i < arr.length; i++) {
                            aList_all.push({ count: arr[i].day_count, date: arr[i].day });
                        }
                    }
                    total(aList_all);
                }
            });

            // 封装折线统计图生成函数
            function total(aList) {
                var oChart = echarts.init(document.getElementById('curve_show'));
                var aList_all = aList || [
                    { 'count': 36, 'date': '2019-04-13' },
                    { 'count': 52, 'date': '2019-04-14' },
                    { 'count': 78, 'date': '2019-04-15' },
                    { 'count': 85, 'date': '2019-04-16' },
                    { 'count': 65, 'date': '2019-04-17' },
                    { 'count': 72, 'date': '2019-04-18' },
                    { 'count': 88, 'date': '2019-04-19' },
                    { 'count': 64, 'date': '2019-04-20' },
                    { 'count': 72, 'date': '2019-04-21' },
                    { 'count': 90, 'date': '2019-04-22' },
                    { 'count': 96, 'date': '2019-04-23' },
                    { 'count': 100, 'date': '2019-04-24' },
                    { 'count': 102, 'date': '2019-04-25' },
                    { 'count': 110, 'date': '2019-04-26' },
                    { 'count': 123, 'date': '2019-04-27' },
                    { 'count': 100, 'date': '2019-04-28' },
                    { 'count': 132, 'date': '2019-04-29' },
                    { 'count': 146, 'date': '2019-04-30' },
                    { 'count': 200, 'date': '2019-05-01' },
                    { 'count': 180, 'date': '2019-05-02' },
                    { 'count': 163, 'date': '2019-05-03' },
                    { 'count': 110, 'date': '2019-05-04' },
                    { 'count': 80, 'date': '2019-05-05' },
                    { 'count': 82, 'date': '2019-05-06' },
                    { 'count': 70, 'date': '2019-05-07' },
                    { 'count': 65, 'date': '2019-05-08' },
                    { 'count': 54, 'date': '2019-05-09' },
                    { 'count': 40, 'date': '2019-05-10' },
                    { 'count': 45, 'date': '2019-05-11' },
                    { 'count': 38, 'date': '2019-05-12' },
                ];

                // console.log(aList_all);

                let aCount = [];
                let aDate = [];

                for (var i = 0; i < aList_all.length; i++) {
                    aCount.push(aList_all[i].count);
                    aDate.push(aList_all[i].date);
                }

                // console.log(aCount);
                // console.log(aDate);

                var chartopt = {
                    title: {
                        text: '月新增文章数',
                        left: 'center',
                        top: '10'
                    },
                    tooltip: {
                        trigger: 'axis'
                    },
                    legend: {
                        data: ['新增文章'],
                        top: '40'
                    },
                    toolbox: {
                        show: true,
                        feature: {
                            mark: { show: true },
                            dataView: { show: true, readOnly: false },
                            magicType: { show: true, type: ['line', 'bar'] },
                            restore: { show: true },
                            saveAsImage: { show: true }
                        }
                    },
                    calculable: true,
                    xAxis: [
                        {
                            name: '日',
                            type: 'category',
                            boundaryGap: false,
                            data: aDate
                        }
                    ],
                    yAxis: [
                        {
                            name: '月新增文章数',
                            type: 'value'
                        }
                    ],
                    series: [
                        {
                            name: '新增文章',
                            type: 'line',
                            smooth: true,
                            itemStyle: { normal: { areaStyle: { type: 'default' }, color: '#f80' }, lineStyle: { color: '#f80' } },
                            data: aCount
                        }],
                    areaStyle: {
                        normal: {
                            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
                                offset: 0,
                                color: 'rgba(255,136,0,0.39)'
                            }, {
                                offset: .34,
                                color: 'rgba(255,180,0,0.25)'
                            }, {
                                offset: 1,
                                color: 'rgba(255,222,0,0.00)'
                            }])

                        }
                    },
                    grid: {
                        show: true,
                        x: 50,
                        x2: 50,
                        y: 80,
                        height: 220
                    }
                };

                oChart.setOption(chartopt);
            }

            // 获取文章类型数组供月文章访问量功能模块
            var serieskeyData;
            // 文章类型数组变量
            var ColorArr;

            // 各类型文章数量统计功能模块
            oPieoptFunc();
            // 请求数据
            $.get({
                url: "http://localhost:8000/admin/article_category_count",
                success: function (backData) {
                    // console.log(backData);
                    var keyData;
                    var oPieoptObject;
                    if (backData.code == 200) {
                        // 初始化数组keyData及oPieoptObject
                        keyData = [];
                        oPieoptObject = [];
                        // 初始化文章类型统计图颜色数组
                        ColorArr = [];

                        var arr = backData.data;

                        // 遍历backData.data,获取各类型文章统计数量
                        for (var i = 0; i < arr.length; i++) {
                            keyData.push(arr[i].type);
                            oPieoptObject.push({ name: arr[i].type, value: arr[i].all_count });
                            ColorArr.push(getColor());
                        }
                        // console.log(keyData);
                        // console.log(oPieoptObject);
                    }
                    serieskeyData = keyData;
                    oPieoptFunc(keyData, oPieoptObject, ColorArr);
                },
            });

            // 封装饼形统计图生成函数
            function oPieoptFunc(keyData, oPieoptObject, ColorArr) {
                var kData = keyData || ['奇趣事', '会生活', '爱旅行', '趣美味'];
                var oPieoptO = oPieoptObject
                    || [
                        { value: 300, name: '奇趣事' },
                        { value: 100, name: '会生活' },
                        { value: 260, name: '爱旅行' },
                        { value: 180, name: '趣美味' }
                    ];
                var Color = ColorArr || ['#5885e8', '#13cfd5', '#00ce68', '#ff9565'];
                var oPie = echarts.init(document.getElementById('pie_show'));
                var oPieopt =
                {
                    title: {
                        top: 10,
                        text: '分类文章数量比',
                        x: 'center'
                    },
                    tooltip: {
                        trigger: 'item',
                        formatter: "{a} <br/>{b} : {c} ({d}%)"
                    },
                    color: Color,
                    legend: {
                        x: 'center',
                        top: 65,
                        // data属性数据对应数组kData
                        data: kData
                    },
                    toolbox: {
                        show: true,
                        x: 'center',
                        top: 35,
                        feature: {
                            mark: { show: true },
                            dataView: { show: true, readOnly: false },
                            magicType: {
                                show: true,
                                type: ['pie', 'funnel'],
                                option: {
                                    funnel: {
                                        x: '25%',
                                        width: '50%',
                                        funnelAlign: 'left',
                                        max: 1548
                                    }
                                }
                            },
                            restore: { show: true },
                            saveAsImage: { show: true }
                        }
                    },
                    calculable: true,
                    series: [
                        {
                            name: '访问来源',
                            type: 'pie',
                            radius: ['45%', '60%'],
                            center: ['50%', '65%'],
                            // data属性数据对应数组oPieoptO
                            data: oPieoptO
                        }
                    ]
                };
                oPie.setOption(oPieopt);
            }

            // 随机生成颜色
            function getColor() {
                var str = "";
                // 随机颜色数组拼接数组
                var ColorArr = ["a", "b", "c", "d", "e", "f", 1, 2, 3, 4, 5, 6, 7, 8, 9, 0];
                // 组合随机
                while (str == "" || str == "#ffffff") {
                    for (var i = 0; i < 6; i++) {
                        str += ColorArr[parseInt(Math.random() * ColorArr.length)].toString();
                    }
                }
                if (str.length > 0) {
                    str = "#" + str;
                }
                return str;
            }

            // 月文章访问量功能模块
            // 初始化月文章访问量功能模块
            // setOptionFunc();

            // 请求月文章访问量数据
            $.get({
                url: "http://localhost:8000/admin/article_category_visit",
                success: function (backData) {
                    // console.log(backData);
                    var monthData;
                    var seriesData;
                    if (backData.code == 200) {
                        // 初始化月份数组monthData
                        monthData = [];
                        // 初始化统计图形条数组seriesData
                        seriesData = [];
                        // 数组seriesDataCopy承载seriesData数组中对象的可变属性,提供seriesData数组构建数据
                        var seriesDataCopy = [];

                        // 文章类型初始化对象
                        for (var i = 0; i < serieskeyData.length; i++) {
                            seriesDataCopy.push({
                                name: serieskeyData[i],
                                data: [],
                                color: ColorArr[i]
                            });
                        }

                        // console.log(seriesDataCopy);

                        var arr = backData.data;

                        for (var i = 0; i < arr.length; i++) {
                            // 封装月份
                            monthData.push(arr[i].month);

                            // 遍历backData.data.all_count数组,并将all_count
                            // 数组中对应文章类型名称的统计数量按月份从小到大封装到
                            // 数组all_count中
                            // console.log(arr[0].all_count[0]);
                            // console.log(seriesDataCopy[0].name)
                            for (var j = 0; j < arr[i].all_count.length; j++) {
                                if (seriesDataCopy[j].name == arr[i].all_count[j].type) {
                                    seriesDataCopy[j].data.push(arr[i].all_count[j].count);
                                }
                            }
                        }

                        // 封装条形统计图数据对象封装
                        for (var i = 0; i < seriesDataCopy.length; i++) {
                            seriesData.push(
                                {
                                    name: seriesDataCopy[i].name,
                                    type: 'bar',
                                    barWidth: 20,
                                    itemStyle: {
                                        normal: { areaStyle: { type: 'default' }, color: seriesDataCopy[i].color }
                                    },
                                    data: seriesDataCopy[i].data
                                }
                            )
                        }
                        // console.log(seriesData);
                    }
                    // setOptionFunc(serieskeyData, monthData, seriesData);
                }
            });

            // 获取文章类别数组keyData
            var keyD = ['奇趣事', '会生活', '爱旅行', '趣美味'];
            // 获取文章数量统计的月数
            var monthD = ['1月', '2月', '3月', '4月', '5月'];
            // 获取生成条形统计图数组对象参数
            var seriesD = [
                {
                    name: '奇趣事',
                    type: 'bar',
                    barWidth: 20,
                    itemStyle: {
                        normal: { areaStyle: { type: 'default' }, color: '#fd956a' }
                    },
                    data: [800, 708, 920, 1090, 1200]
                },
                {
                    name: '会生活',
                    type: 'bar',
                    barWidth: 20,
                    itemStyle: {
                        normal: { areaStyle: { type: 'default' }, color: '#2bb6db' }
                    },
                    data: [400, 468, 520, 690, 800]
                },
                {
                    name: '爱旅行',
                    type: 'bar',
                    barWidth: 20,
                    itemStyle: {
                        normal: { areaStyle: { type: 'default' }, color: '#13cfd5' }
                    },
                    data: [500, 668, 520, 790, 900]
                },
                {
                    name: '趣美味',
                    type: 'bar',
                    barWidth: 20,
                    itemStyle: {
                        normal: { areaStyle: { type: 'default' }, color: '#00ce68' }
                    },
                    data: [600, 508, 720, 890, 1000]
                }
            ];

            var oColumn = this.echarts.init(document.getElementById('column_show'));
            var setOption =
            {
                title: {
                    text: '文章访问量',
                    left: 'center',
                    top: '10'
                },
                tooltip: {
                    trigger: 'axis'
                },
                legend: {
                    data: keyD,
                    top: '40'
                },
                toolbox: {
                    show: true,
                    feature: {
                        mark: { show: true },
                        dataView: { show: true, readOnly: false },
                        magicType: { show: true, type: ['line', 'bar'] },
                        restore: { show: true },
                        saveAsImage: { show: true }
                    }
                },
                calculable: true,
                xAxis: [
                    {
                        type: 'category',
                        data: monthD
                    }
                ],
                yAxis: [
                    {
                        name: '访问量',
                        type: 'value'
                    }
                ],
                series: seriesD,
                grid: {
                    show: true,
                    x: 50,
                    x2: 30,
                    y: 80,
                    height: 260
                },
                dataZoom: [//给x轴设置滚动条
                    {
                        start: 0,//默认为0
                        end: 100 - 1000 / 31,//默认为100
                        type: 'slider',
                        show: true,
                        xAxisIndex: [0],
                        handleSize: 0,//滑动条的 左右2个滑动条的大小
                        height: 8,//组件高度
                        left: 45, //左边的距离
                        right: 50,//右边的距离
                        bottom: 26,//右边的距离
                        handleColor: '#ddd',//h滑动图标的颜色
                        handleStyle: {
                            borderColor: "#cacaca",
                            borderWidth: "1",
                            shadowBlur: 2,
                            background: "#ddd",
                            shadowColor: "#ddd",
                        }
                    }]
            };
            oColumn.setOption(oColumnopt);

            // 封装条形统计图生成函数
            // function setOptionFunc(keyData, monthData, seriesData) {
            //     // 获取文章类别数组keyData
            //     var keyD = keyData || ['奇趣事', '会生活', '爱旅行', '趣美味'];
            //     // 获取文章数量统计的月数
            //     var monthD = monthData || ['1月', '2月', '3月', '4月', '5月'];
            //     // 获取生成条形统计图数组对象参数
            //     var seriesD = seriesData || [
            //         {
            //             name: '奇趣事',
            //             type: 'bar',
            //             barWidth: 20,
            //             itemStyle: {
            //                 normal: { areaStyle: { type: 'default' }, color: '#fd956a' }
            //             },
            //             data: [800, 708, 920, 1090, 1200]
            //         },
            //         {
            //             name: '会生活',
            //             type: 'bar',
            //             barWidth: 20,
            //             itemStyle: {
            //                 normal: { areaStyle: { type: 'default' }, color: '#2bb6db' }
            //             },
            //             data: [400, 468, 520, 690, 800]
            //         },
            //         {
            //             name: '爱旅行',
            //             type: 'bar',
            //             barWidth: 20,
            //             itemStyle: {
            //                 normal: { areaStyle: { type: 'default' }, color: '#13cfd5' }
            //             },
            //             data: [500, 668, 520, 790, 900]
            //         },
            //         {
            //             name: '趣美味',
            //             type: 'bar',
            //             barWidth: 20,
            //             itemStyle: {
            //                 normal: { areaStyle: { type: 'default' }, color: '#00ce68' }
            //             },
            //             data: [600, 508, 720, 890, 1000]
            //         }
            //     ];

            //     var oColumn = this.echarts.init(document.getElementById('column_show'));
            //     var setOption =
            //     {
            //         title: {
            //             text: '文章访问量',
            //             left: 'center',
            //             top: '10'
            //         },
            //         tooltip: {
            //             trigger: 'axis'
            //         },
            //         legend: {
            //             data: keyData,
            //             top: '40'
            //         },
            //         toolbox: {
            //             show: true,
            //             feature: {
            //                 mark: { show: true },
            //                 dataView: { show: true, readOnly: false },
            //                 magicType: { show: true, type: ['line', 'bar'] },
            //                 restore: { show: true },
            //                 saveAsImage: { show: true }
            //             }
            //         },
            //         calculable: true,
            //         xAxis: [
            //             {
            //                 type: 'category',
            //                 data: monthD
            //             }
            //         ],
            //         yAxis: [
            //             {
            //                 name: '访问量',
            //                 type: 'value'
            //             }
            //         ],
            //         series: seriesD,
            //         grid: {
            //             show: true,
            //             x: 50,
            //             x2: 30,
            //             y: 80,
            //             height: 260
            //         },
            //         dataZoom: [//给x轴设置滚动条
            //             {
            //                 start: 0,//默认为0
            //                 end: 100 - 1000 / 31,//默认为100
            //                 type: 'slider',
            //                 show: true,
            //                 xAxisIndex: [0],
            //                 handleSize: 0,//滑动条的 左右2个滑动条的大小
            //                 height: 8,//组件高度
            //                 left: 45, //左边的距离
            //                 right: 50,//右边的距离
            //                 bottom: 26,//右边的距离
            //                 handleColor: '#ddd',//h滑动图标的颜色
            //                 handleStyle: {
            //                     borderColor: "#cacaca",
            //                     borderWidth: "1",
            //                     shadowBlur: 2,
            //                     background: "#ddd",
            //                     shadowColor: "#ddd",
            //                 }
            //             }]
            //     };
            //     oColumn.setOption(oColumnopt);
            // }

        </script>


    </body>

</html>